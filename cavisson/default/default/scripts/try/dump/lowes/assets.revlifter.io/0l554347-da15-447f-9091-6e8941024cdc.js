(function(){"use strict";var a=function(a,b,c,d,e){this.dataCollectorEndpoint=a,this.thirdPartyCookieEndPoint=b,this.cookieLength=c,this.firstPartyCookieDomain=d,this.sessionDays=e,this.queue=window[window.RevLifterObject].q,this.siteId=null,this.userId=null,this.sessionId=null,this.revLifterCookie=null,this.queueHandlers=[],this.customFunctions=[],this.registry={lightboxes:{},lastScrollPc:0}};a.prototype.bootstrap=function(){f("BOOTSTRAP"),this.revLifterCookie=new c(this.cookieLength,this.firstPartyCookieDomain,this.sessionDays),this.revLifterCookie.load(),f("RevLifter Cookie Loaded"),this.queue.process=function(){this.processQueue()}.bind(this),this.queue.push=function(a){Array.prototype.push.apply(this,[a]),this.process()},f("Start initial queue processing"),this.processQueue(),f("Initial queue processing complete"),f("Process all custom functions"),this.processCustomFunctions(),f("All custom functions processed"),f("REVLIFTER COMPLETE"),this.revLifterCookie.persist()},a.prototype.cookie=function(){return this.revLifterCookie},a.prototype.getContext=function(){return this.revLifterCookie.data},a.prototype.getRegistry=function(){return this.registry},a.prototype.newSession=function(){this.revLifterCookie.newSession(),this.revLifterCookie.persist()},a.prototype.processQueue=function(){this.batch=this.queue;for(var a=0;a<this.batch.length;a++)for(var b=0;b<this.queueHandlers.length;b++)this.queueHandlers[b].handles(this.batch[a][0])&&this.queueHandlers[b].process(this.batch[a]);this.queue.splice(0,this.queue.length)},a.prototype.processCustomFunctions=function(){this.customFunctions.forEach(function(a){a()})},a.prototype.registerQueueHandler=function(a){this.queueHandlers.push(a)},a.prototype.createPayloadMessage=function(a,b){return{timeStamp:111111111,payloadType:a,payload:b,context:this.cookie().getData()}},a.prototype.registerCustomFunction=function(a){this.customFunctions.push(a)};var b=new a("https://api.revlifter.io/v1/kinesis-collect","https://api.official-deals.co.uk/v1/pixel",365,"lowes.com",30);b.registerQueueHandler({handles:function(a){return"load"===a},process:function(a){f("Started LoadQueueHandler processing: "+a[1].replace(".js","").replace("[","").replace("]","")),b.siteId=a[1].replace(".js","").replace("[","").replace("]",""),f("Site identified as "+b.siteId),b.revLifterCookie.isSet()?b.cookie().checkSession():(f("No 1st party cookie set, initialising"),b.cookie().init(b.siteId,d()),b.cookie().persist(),f("Initialised Cookie with values: "+JSON.stringify(b.cookie().getData()))),b.userId=b.cookie().get("u"),b.sessionId=b.cookie().get("s"),f("Finished LoadQueueHandler processing")}});b.registerQueueHandler({handles:function(a){return"send"===a},process:function(a){switch(f("Started SendQueueHandler processing:"+a[1]),f("Payload: "+JSON.stringify(a[2])),a[1]){case"dataCollector":f("Making AJAX request to "+b.dataCollectorEndpoint),e(b.dataCollectorEndpoint,JSON.stringify({Data:[a[2]]}),function(){f("Data collector returned 200 response")});break;default:}f("Finished SendQueueHandler Processing")}});var c=function(a,b,c){this.data={},this.days=a,this.cookieDomain=b,this.sessionDays=c,this.name="REVLIFTER",this.stale=!1};c.prototype.getData=function(){return this.data},c.prototype.checkSession=function(){Math.floor(Date.now()/1e3)>this.data.se&&(this.newSession(),this.save(),this.saveThirdParty())},c.prototype.newSession=function(){this.data.s=d(),this.data.se=Math.floor(Date.now()/1e3)+86400*this.sessionDays,this.stale=!0},c.prototype.load=function(){var a=this.name+"=",b=decodeURIComponent(document.cookie),d=b.split(";");window.rlca=d;for(var e,f=0;f<d.length;f++){for(e=d[f];" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(a)&&""!==e.substring(a.length,e.length))return this.data=JSON.parse(e.substring(a.length,e.length)),this.data}return this.data={},{}},c.prototype.init=function(a,b){this.set("w",a),this.set("u",b),this.newSession(),this.stale=!0},c.prototype.get=function(a){return this.data[a]},c.prototype.set=function(a,b){null===this.data&&this.data.hasOwnProperty(a)||(this.data[a]=b)},c.prototype.save=function(){if({}!==this.data){var a=new Date;a.setTime(a.getTime()+1e3*(60*(60*(24*this.days))));var b="; expires="+a.toGMTString();document.cookie=this.name+"="+JSON.stringify(this.data)+b+"; path=/; domain=."+this.cookieDomain,f("First Party Cookie Saved")}},c.prototype.saveThirdParty=function(){var a=document.createElement("img");a.src=b.thirdPartyCookieEndPoint+"?c="+encodeURI(JSON.stringify(this.data));var c=document.getElementsByTagName("body")[0];c.appendChild(a),f("Third party cookie pixel drop complete: "+b.thirdPartyCookieEndPoint+"?c="+encodeURI(JSON.stringify(this.data)))},c.prototype.isSet=function(){return 0<Object.keys(this.data).length},c.prototype.persist=function(){this.stale&&(this.save(),this.saveThirdParty(),this.stale=!1)};b.registerCustomFunction(function(){window.dataLayer&&"/cart"==window.location.pathname&&revlifter("send","dataCollector",b.createPayloadMessage("userdata",window.dataLayer))});var d=function(){var a,b,c="";for(a=0;32>a;a++)b=0|16*Math.random(),(8===a||12===a||16===a||20===a)&&(c+="-"),c+=(12===a?4:16===a?8|3&b:b).toString(16);return c},e=function(a,b,c){var d="string"==typeof b?b:Object.keys(b).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(b[a])}).join("&"),e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return e.open("POST",a),e.onreadystatechange=function(){3<e.readyState&&200===e.status&&c(e.responseText)},e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-Type","application/json"),e.send(d),e};b.getQueryString=function(a,b){var c=b?b:window.location.href,d=new RegExp("[?&]"+a+"=([^&#]*)","i"),e=d.exec(c);return e?e[1]:null};var f=function(){var a=new Date;"undefined"==typeof window.rlstart?(window.rltiming=0,window.rlstart=a.getMilliseconds()):window.rltiming=a.getMilliseconds()-window.rlstart};window.addEventListener("message",function(a){a.data.hasOwnProperty("revlifter")&&(a.data.revlifter.params.eventOrigin=a.origin,revlifter(a.data.revlifter.handler,a.data.revlifter.params))}),b.bootstrap()})();