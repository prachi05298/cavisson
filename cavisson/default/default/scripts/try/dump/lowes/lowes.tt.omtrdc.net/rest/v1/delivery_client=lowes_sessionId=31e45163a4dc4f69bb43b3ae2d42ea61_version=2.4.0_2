{"status":200,"requestId":"76cf9d09ad21466285770070a4967e89","client":"lowes","id":{"tntId":"31e45163a4dc4f69bb43b3ae2d42ea61.31_0","marketingCloudVisitorId":"71747673865418841840298191736677393887"},"edgeHost":"mboxedge31.tt.omtrdc.net","execute":{"mboxes":[{"index":0,"name":"lwscom_hp","options":[{"content":"<script type=\"text/javascript\" data-type=\"reco_utils\">\n    /* eslint-disable */\n\n    /**\n     *\n     *\n     *\n     *\n     * reco_utils.js\n     *\n     * Inserted by the DDO Mboxes script from DTM and Launch\n     *\n     */\n    (\n        function (digitalData, dataLayer, helper, appMeasure) {\n\n            /**\n             *\n             *\n             *\n             * insert debugLog function\n             */\n            if (document.location.hostname !== 'www.lowes.com'\n                || document.location.search.indexOf('debug=1') >= 0) {\n                window.debugLog = function (input) {\n                    console.log(input);\n                };\n            } else {\n                window.debugLog = function (input) {\n                    return input;\n                };\n            }\n\n            debugLog('loaded reco_utils.js...');\n\n            /**\n             *\n             *\n             * Populating DigitalData/DataLayer object with recommendations data.\n             *\n             *\n             * @param objectType\n             * @param recoObj\n             */\n            var populateDataObject = function (objectType, recoObj) {\n                try {\n                    objectType.recommendations = objectType.recommendations || {};\n                    objectType.recommendations.offers = objectType.recommendations.offers || {};\n\n                    objectType.recommendations.offers[recoObj.divName] = recoObj;\n                } catch (e) {\n                    debugLog(e.message);\n                }\n            };\n\n            /**\n             *\n             *\n             * carouselEventHandler\n             *\n             * @param event\n             */\n            var carouselEventHandler = function (event) {\n                debugLog('got carousel?');\n\n                try {\n                    if (event.data) {\n                        var theseRecos = [{\n                            'location': 'reco_location',\n                            'type': 'mint'\n                        }];\n                    } else {\n                        theseRecos = scanContainers();\n                    }\n\n                    var i, listLen = theseRecos.length;\n                    var thisReco;\n\n                    for (i = 0; i < listLen; i++) {\n                        thisReco = theseRecos[i];\n\n                        //for populating recommendations object in dataLayer object / DLO\n                        populateDataObject(dataLayer, thisReco);\n\n                        //for populating recommendations object  in digitalData object / DDO\n                        populateDataObject(digitalData, thisReco);\n                    }\n\n                } catch (e) {\n                    debugLog(e.message);\n                }\n            };\n\n            /**\n             *\n             *\n             *\n             * isElement\n             *\n             * @param element\n             * @returns {boolean}\n             */\n            var isElement = function(element) {\n                return (\n                    typeof element === \"undefined\" ||\n                    element instanceof Element ||\n                    element instanceof HTMLDocument\n                );\n            };\n\n            /**\n             *\n             *\n             *\n             * getRecsImpressionValue\n             *\n             * @param element\n             * @param tagName\n             * @returns {string}\n             */\n            var getRecsImpressionValue = function(element, tagName) {\n                var recImpressionList = [];\n\n                $(element).find(\".js-recommend-product\").each(function(index, item) {\n                    recImpressionList.push(\n                        item.getAttribute(\"data-productid\") + \":\" +\n                        (index + 1) + \":\" + tagName\n                    );\n                });\n\n                return recImpressionList.join(\",\");\n            };\n\n            /**\n             *\n             *\n             *\n             * sendImpressionCall\n             *\n             * @param element\n             * @param tagName\n             */\n            var sendImpressionCall = function(element, tagName) {\n                // check once here, so we dont need to check in each helper\n                if (!isElement(element)) {\n                    console.warn(\"reco_utils: sendImpressionCall(): element is not an HTML element.\");\n                    return;\n                }\n\n                var helper = window.DTMDataHelper;\n                var appMeasure = window.s;\n\n                var recList = getRecsImpressionValue(element, tagName);\n                var environment = (document.location.hostname === 'www.lowes.com') ? 'prod' : 'staging';\n                var pageName;\n                var prodMerch;\n\n                if (parseFloat(appMeasure.version) < 2) {\n                    // older version - from DTM - DTMDataHelper is present\n                    appMeasure.clearVars();\n                    // appMeasure.pageName = _satellite.getVar(\"scPageName\");\n                    helper.setGlobalClickVarsNoCache();\n                    pageName = helper.get(digitalData, \"page.pageType\", \"\");\n                    appMeasure.eVar2 = helper.get(digitalData, \"profile.visitorStatus\", \"\");\n                    appMeasure.eVar27 = helper.get(digitalData, \"profile.user.storeNumber\", \"\");\n                    prodMerch = \";productmerch\" + appMeasure.productNum;\n                }\n                else {\n                    // newer version - from Launch\n                    appMeasure.clearAll();\n                    pageName = appMeasure.get(digitalData, \"page.pageType\", \"\");\n                    appMeasure.eVar2 = appMeasure.get(digitalData, \"profile.visitorStatus\", \"\");\n                    appMeasure.eVar27 = appMeasure.get(digitalData, \"profile.user.storeNumber\", \"\");\n                    prodMerch = appMeasure.getProdMerch();\n                }\n\n                // set the global shared vars\n                var publishDate;\n                if (_satellite.buildDate) {\n                    publishDate = _satellite.buildDate;\n                }\n                else {\n                    publishDate = _satellite.buildInfo.buildDate.replace(/[TZ]/g, ' ') + 'utc';\n                }\n                appMeasure.pageName = _satellite.getVar(\"scPageName\");\n                appMeasure.channel = _satellite.getVar(\"siteSection\");\n                appMeasure.prop1 = _satellite.getVar(\"siteSectionTwo\");\n                appMeasure.prop2 = _satellite.getVar(\"siteSectionThree\");\n                appMeasure.prop3 = _satellite.getVar(\"siteSectionFour\");\n                appMeasure.prop4 = \"D=v5\";\n                appMeasure.prop6 = _satellite.getVar(\"scPageNameNoSite\");\n                appMeasure.prop10 = (\"publish-\" + publishDate + \"|\" + appMeasure.version + \"|\" + environment).toLowerCase();\n                appMeasure.prop23 = _satellite.getVar(\"siteId\");\n                appMeasure.eVar3 = _satellite.getVar(\"userID\");\n                appMeasure.eVar4 = \"D=pageName\";\n                appMeasure.eVar5 = pageName;\n                appMeasure.eVar88 = \"D=mid\";\n\n                if (!appMeasure.prop6) {\n                    var nameBits = appMeasure.pageName.split(/:/);\n                    appMeasure.prop6 = [nameBits[0],nameBits[2]].join(':');\n                }\n                if (!appMeasure.prop1) {\n                    appMeasure.prop1 = 'D=' + appMeasure.channel;\n                }\n                if (!appMeasure.prop2) {\n                    appMeasure.prop2 = appMeasure.prop1;\n                }\n                if (!appMeasure.prop3) {\n                    appMeasure.prop3 = appMeasure.prop2;\n                }\n\n                if (appMeasure.event === undefined) {\n                    appMeasure.events = '';\n                }\n\n                if (pageName !== 'product-display') {\n                    appMeasure.events = appMeasure.events + ',event55,event71';\n                    appMeasure.products = prodMerch;\n                } else {\n                    appMeasure.events = appMeasure.events + ',event55';\n                    appMeasure.products = ';' + _satellite.getVar('pdpProductIVM') + ';;;;eVar19=' + _satellite.getVar('pdpProductID');\n                }\n\n                if (recList.length > 0) {\n                    // mbox inmpression\n                    appMeasure.linkTrackVars = appMeasure.linkTrackVars + ',products,list3,tnt,eVar158,channel,prop1,prop2,prop3,prop4,prop5,prop6,prop10,prop23,eVar2,eVar3,eVar4,eVar5,eVar27,eVar88';\n                    appMeasure.linkTrackEvents = appMeasure.linkTrackEvents + ',event55,event71,event191';\n                    appMeasure.events = appMeasure.events + ',event191';\n\n                    appMeasure.eVar56 = element.getAttribute('id');\n                    appMeasure.list3 = recList;\n                    appMeasure.eVar158 = \"reco:\" + pageName + \":\" + tagName;\n                    appMeasure.tl(true, 'o', 'ajax_mbox_impression');\n                }\n                else {\n                    // mbox load\n                    appMeasure.linkTrackVars = appMeasure.linkTrackVars + ',products,tnt,eVar56';\n                    appMeasure.eVar56 = element.getAttribute('id');\n                    appMeasure.tl(true, 'o', 'ajax_mbox_load');\n                }\n            };\n\n            /**\n             *\n             *\n             *\n             * scanContainers\n             *\n             * if no carousel information is found, run through the containers and see what's in them\n             *\n             * @return {Array}\n             */\n            var scanContainers = function () {\n\n                var theseContainers = document.querySelectorAll('.gcp-carousel-container');\n                var thisContainer;\n                var i, j, itemLen, listLen = theseContainers.length;\n                var thisItem;\n                var recoList = [];\n                var thisTitle;\n                var thisObj;\n\n                for (i = 0; i < listLen; i++) {\n                    thisContainer = theseContainers[i];\n                    var thisDivLocation = thisContainer.getAttribute('id');\n                    var thisMboxName = thisContainer.getAttribute('data-at-mbox-name');\n                    var tracking = thisContainer.getAttribute('tracked');\n\n                    if (!tracking) {\n                        thisTitle = thisContainer.getElementsByTagName('h2');\n                        if (thisTitle.length === 0) thisTitle = thisContainer.getElementsByTagName('h1');\n                        thisTitle = (thisTitle.length === 0) ? '' : thisTitle[0].innerText;\n\n                        if (thisTitle) {\n\n                            if (thisTitle.indexOf(\"''\") >= 0) {\n                                // escape for Customers Who Searched strings\n                                var titleBites = thisTitle.split(/''/);\n                                thisTitle = titleBites[0] + titleBites[2];\n                                thisTitle = thisTitle.replace(/\\s\\s/, ' ');\n                            }\n\n                            var thisTagName = (window.DTMDataHelper) ? window.DTMDataHelper.cleanAnalyticsData(thisTitle) : window.s.format(thisTitle);\n\n                            thisObj = {\n                                divName: thisDivLocation,\n                                title: thisTitle,\n                                location: thisMboxName,\n                                tagName: thisTagName,\n                                type: 'mint'\n                            };\n\n                            // go look for item list and get the ids while we're here\n                            var itemsList = thisContainer.querySelectorAll('.js-recommend-product');\n                            var thisId;\n                            var thisIVM;\n                            var thisIndex;\n                            var productList = {};\n                            itemLen = itemsList.length;\n\n                            for (j = 0; j < itemLen; j++) {\n                                thisItem = itemsList[j];\n                                thisId = thisItem.getAttribute('data-productid');\n                                thisIVM = thisItem.getAttribute('data-ivm');\n                                thisIndex = thisItem.getAttribute('data-index');\n                                thisIndex = (thisIndex) ? thisIndex : j;\n                                productList[thisIndex] = {\n                                    'id': thisId,\n                                    'ivm': thisIVM\n                                }\n                            }\n                            thisObj.products = productList;\n                            thisContainer.setAttribute('tracked', 'true');\n\n                            recoList.push(thisObj);\n\n                            sendImpressionCall(thisContainer, thisTagName);\n                        }\n                    }\n                }\n\n                return recoList;\n            };\n\n            /**\n             *\n             *\n             * setListeners\n             *\n             */\n            var setListeners = function () {\n                $(document).on('carousel init', carouselEventHandler);\n            };\n\n            /**\n             *\n             *\n             *\n             * OK then, set things up\n             */\n            digitalData.recommendations = digitalData.recommendations || {};\n            digitalData.recommendations.offers = digitalData.recommendations.offers || {};\n\n            dataLayer.recommendations = dataLayer.recommendations || {};\n            dataLayer.recommendations.offers = dataLayer.recommendations.offers || {};\n\n            setListeners();\n            scanContainers();\n        }\n\n    )(window.digitalData, window.dataLayer, window.DTMDataHelper, window.s);\n\n//# sourceURL=reco_utils.js\n\n</script>\n","type":"html","responseTokens":{"experience.id":"0","activity.name":"Inject HP Helix reco_utils.js","activity.id":"530234","experience.name":"Experience A","option.name":"Offer2","option.id":"2","profile.activeActivities":"530234","profile.JJTest01":"target-global-mbox","profile.signedInUser":""},"sourceType":"target"}]}]}}